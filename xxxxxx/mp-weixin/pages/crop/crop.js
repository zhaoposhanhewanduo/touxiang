(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/crop/crop"],{"51db":function(t,e,c){"use strict";var o;c.d(e,"b",(function(){return a})),c.d(e,"c",(function(){return n})),c.d(e,"a",(function(){return o}));var a=function(){var t=this,e=t.$createElement;t._self._c},n=[]},5380:function(t,e,c){},8715:function(t,e,c){"use strict";(function(t){c("f47e");o(c("66fd"));var e=o(c("c40a"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,c("543d")["createPage"])},adf7:function(t,e,c){"use strict";var o=c("5380"),a=c.n(o);a.a},b738:function(t,e,c){"use strict";c.r(e);var o=c("c8c9"),a=c.n(o);for(var n in o)"default"!==n&&function(t){c.d(e,t,(function(){return o[t]}))}(n);e["default"]=a.a},c40a:function(t,e,c){"use strict";c.r(e);var o=c("51db"),a=c("b738");for(var n in a)"default"!==n&&function(t){c.d(e,t,(function(){return a[t]}))}(n);c("adf7");var i,r=c("f0c5"),s=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);e["default"]=s.exports},c8c9:function(t,e,c){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=t.getSystemInfoSync(),o=c.screenWidth,a=80,n=c.screenHeight-a;console.log("SCREEN_HEIGHT",n);var i=o.toFixed(3)/n.toFixed(3);console.log("SCREEN_RATIO",i);c.pixelRatio;var r,s,u,p,l,h,g,d,f,m,v,I=1,W=100,H=c.screenWidth,w={data:function(){return{windowHeight:0,name:"薛大宝",imageSrc:"https://img-cdn-qiniu.dcloud.net.cn/demo_crop.jpg",isShowImg:!1,cropperInitW:o,cropperInitH:o,cropperW:o,cropperH:o,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cropBoxW:o,cutL:0,cutT:0,cutB:o,cutR:"100%",qualityWidth:H,innerAspectRadio:I}},onLoad:function(t){console.log("onLoad"),console.log("option.tempFilePath",t.tempFilePath),this.getImageFromFront(t.tempFilePath)},onReady:function(){},onShow:function(){this.windowHeight=getApp().globalData.WINDOW_HEIGHT},methods:{setData:function(t){var e=this;Object.keys(t).forEach((function(c){e.$set(e.$data,c,t[c])}))},getImageFromFront:function(e){var c=this;t.getImageInfo({src:e,success:function(t){c._adjustParameters(t,c)}}),c.loadAndShowImage(e)},cancel:function(){t.navigateBack({delta:1})},chooseImage:function(){var e=this;t.chooseImage({success:function(c){t.getImageInfo({src:c.tempFilePaths[0],success:function(t){e._adjustParameters(t,e)}}),e.imageCheck(c.tempFilePaths[0],e.loadAndShowImage)}})},loadAndShowImage:function(t){this.setData({imageSrc:t}),this.loadImage(t)},_adjustParameters:function(t,e){var c=t.width,a=t.height;c<a?(e.cropperW=o,e.cropperH=a.toFixed(3)/c.toFixed(3)*o):(e.cropperH=o,e.cropperW=c.toFixed(3)/a.toFixed(3)*o),e.cropperH>o?(e.cropperH=o,e.cropperW=c.toFixed(3)/a.toFixed(3)*o,e.cropBoxW=e.cropperW,e.cropperInitW=e.cropperW,e.cropperInitH=e.cropperH):e.cropperW>o&&(e.cropperW=o,e.cropperH=a.toFixed(3)/c.toFixed(3)*o,e.cropBoxW=e.cropperH,e.cropperInitW=e.cropperW,e.cropperInitH=e.cropperH),console.log(t.width),console.log(t.height)},loadImage:function(e){var c=this;t.showLoading({title:"加载中..."}),t.getImageInfo({src:e,success:function(e){f=e.width/e.height,console.log("IMG_RATIO",f),f>=1?(m=o,v=o/f):(m=o*f,v=o);var a=m>v?m:v;if(W=a>W?W:a,f>=1){var n=0,i=n,r=Math.ceil((o-c.cropBoxW)/2),s=r;c.setData({cropperW:o,cropperH:o/f,cropperL:Math.ceil((o-o)/2),cropperT:Math.ceil((o-o/f)/2),cutL:r,cutT:n,cutR:s,cutB:i,imageW:m,imageH:v,scaleP:m/o,qualityWidth:H,innerAspectRadio:f})}else{var u=Math.ceil((o*f-o*f)/2),p=u,l=Math.ceil((o-c.cropBoxW)/2),h=l;c.setData({cropperW:o*f,cropperH:o,cropperL:Math.ceil((o-o*f)/2),cropperT:Math.ceil((o-o)/2),cutL:u,cutT:l,cutR:p,cutB:h,imageW:m,imageH:v,scaleP:m/o,qualityWidth:H,innerAspectRadio:f})}c.setData({isShowImg:!0}),t.hideLoading()}})},contentStartMove:function(t){console.log("contentStartMove"),r=t.touches[0].pageX,s=t.touches[0].pageY},contentMoveing:function(t){console.log("contentMoveing");var e=(r-t.touches[0].pageX)*I,c=(s-t.touches[0].pageY)*I;e>0?this.cutL-e<0&&(e=this.cutL):this.cutR+e<0&&(e=-this.cutR),c>0?this.cutT-c<0&&(c=this.cutT):this.cutB+c<0&&(c=-this.cutB),this.setData({cutL:this.cutL-e,cutT:this.cutT-c,cutR:this.cutR+e,cutB:this.cutB+c}),r=t.touches[0].pageX,s=t.touches[0].pageY},contentTouchEnd:function(){console.log("contentTouchEnd")},cropImage:function(){var e=this;t.showLoading({title:"图片生成中..."});var c=t.createCanvasContext("myCanvas");c.drawImage(e.imageSrc,0,0,m,v),c.draw(!0,(function(){var c=(e.cropperW-e.cutL-e.cutR)/e.cropperW*m,o=(e.cropperH-e.cutT-e.cutB)/e.cropperH*v;f>1?c=o:o=c;var a=e.cutL/e.cropperW*m,n=e.cutT/e.cropperH*v;console.log("IMG_REAL_H",v),t.canvasToTempFilePath({x:a,y:n,width:c,height:o,destWidth:3*c,destHeight:3*o,quality:.5,canvasId:"myCanvas",success:function(e){t.hideLoading(),getApp().globalData.cropImageFilePath=e.tempFilePath,getApp().globalData.rapaintAfterCrop=!0,t.navigateBack({delta:1})}})}))},dragStart:function(t){u=t.touches[0].pageX,p=t.touches[0].pageY,l=this.cutL,g=this.cutR,d=this.cutB,h=this.cutT},dragMove:function(t){var e=t.target.dataset.drag;switch(e){case"right":var c=(u-t.touches[0].pageX)*I;g+c<0&&(c=-g),this.setData({cutR:g+c});break;case"left":c=(u-t.touches[0].pageX)*I;l-c<0&&(c=l),l-c>this.cropperW-this.cutR&&(c=l-(this.cropperW-this.cutR)),this.setData({cutL:l-c});break;case"top":c=(p-t.touches[0].pageY)*I;h-c<0&&(c=h),h-c>this.cropperH-this.cutB&&(c=h-(this.cropperH-this.cutB)),this.setData({cutT:h-c});break;case"bottom":c=(p-t.touches[0].pageY)*I;d+c<0&&(c=-d),this.setData({cutB:d+c});break;case"rightBottom":var o=(u-t.touches[0].pageX)*I,a=(p-t.touches[0].pageY)*I;d+a<0&&(a=-d),g+o<0&&(o=-g);var n=d+a,i=g+o;this.setData({cutB:n,cutR:i});break;default:break}},imageCheck:function(e,c){if(getApp().globalData.enableSecurityCheck){t.compressImage({src:e,quality:1,success:function(o){var a=o.tempFilePath;console.log("tempFilePath size",o.size),wx.getFileSystemManager().readFile({filePath:a,success:function(o){console.log(o.data),t.showLoading({title:"加载中..."}),wx.cloud.callFunction({name:"contentCheck",data:{value:o.data},success:function(o){console.log("checkContent result",o),87014==o.result.errCode?(t.showModal({title:"请勿使用违法违规内容",content:"图片含有违法违规内容",showCancel:!1,confirmText:"知道了"}),console.log("bad")):(console.log("good"),c(e))},fail:function(e){console.log(e),t.showModal({title:"请重试",content:"对不起，服务器开了小差",showCancel:!1,confirmText:"好的"})},complete:function(){t.hideLoading()}})}})}})}else c(e)}}};e.default=w}).call(this,c("543d")["default"])}},[["8715","common/runtime","common/vendor"]]]);