(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/text/add-text"],{"411b":function(t,e,n){},5740:function(t,e,n){"use strict";n.r(e);var o=n("aaca"),a=n("e625");for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);n("c989");var s,c=n("f0c5"),r=Object(c["a"])(a["default"],o["b"],o["c"],!1,null,"0d0eae7d",null,!1,o["a"],s);e["default"]=r.exports},a287:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n("2f62");function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var c=function(){n.e("components/tui/footer").then(function(){return resolve(n("1bec"))}.bind(null,n)).catch(n.oe)},r=function(){n.e("components/tui/tui-fab").then(function(){return resolve(n("e633"))}.bind(null,n)).catch(n.oe)},l=function(){n.e("components/add-tips").then(function(){return resolve(n("493a"))}.bind(null,n)).catch(n.oe)},h=null,d=null,u={components:{tuiFooter:c,tuiFab:r,addTips:l},data:function(){return{ColorList:this.ColorList,windowHeight:0,cansWidth:270,cansHeight:270,cansBgColor:"#FFD314",cornerBgColor:"#C12928",cornerBgBoarderColor:"#FFFFFF",r:40,boarderWidth:15,wishText:"萌",avatarPath:"/static/image/text/纲手.jpg",happinessPathList:["/static/image/happiness/h0.png","/static/image/happiness/h1.png","/static/image/happiness/h2.png","/static/image/happiness/h3.png","/static/image/happiness/h4.png"],happinessIndex:0,copyright:" Copyright © 2016-2020 人文之窗公众号",modalName:null,lastTime:0,x:0,y:0,z:0,lastX:0,lastY:0,lastZ:0,shaking:!1,shakeSpeed:70,lastChangeTime:0,showGentleMessage:!1,savedCounts:0,freeCount:1,enableRewardedVideoAd:!0,enableInterstitialAd:!0,rewardedVideoAdAlreadyShow:!1,interstitialAdAlreadyShow:!1,ownImageUsed:!1,showQuestion:!1,envId:"happiness-production-yy81s",collectionName:"ad_config",docId:"add_happiness_rwzc",statusBarHeight:0,SHOW_TIP:!1,duration:20}},computed:i(i({},(0,o.mapState)({userInfo:"userInfo"})),{},{happinessPath:function(){return this.happinessPathList[this.happinessIndex]},cornerX:function(){return Math.ceil(.7*this.cansWidth)},cornerY:function(){return Math.ceil(.7*this.cansHeight)}}),onLoad:function(e){getApp().globalData.userAvatarFilePath&&(this.avatarPath=getApp().globalData.userAvatarFilePath),this.ctx=t.createCanvasContext("cans-id-happines",this),this.paint();wx.cloud.database({env:this.envId,traceUser:!0})},onReady:function(){console.log("onReady");var e=t.getStorageSync(getApp().globalData.STORAGE_KEY);if(console.log("cache",e),!e){this.statusBarHeight=getApp().globalData.statusBarHeight,this.SHOW_TIP=!0,console.log("SHOW_TIP",this.SHOW_TIP);var n=this;setTimeout((function(){n.SHOW_TIP=!1}),1e3*n.duration)}},onShow:function(){var t=this;console.log("onshow"),getApp().globalData.rapaintAfterCrop?(getApp().globalData.rapaintAfterCrop=!1,this.avatarPath=getApp().globalData.cropImageFilePath,this.paint()):d&&this.enableInterstitialAd&&!this.interstitialAdAlreadyShow&&d.show().then((function(){t.interstitialAdAlreadyShow=!0})).catch((function(t){console.error(t)})),this.windowHeight=getApp().globalData.windowHeight},onHide:function(){},onShareAppMessage:function(){return{title:"我换上了口罩头像，防止疫情蔓延，30款口罩、护目镜任你选！",desc:"防传染、戴口罩，从我做起！",imageUrl:"/static/image/mask/avatar_mask.png",path:"/pages/index/index",success:function(t){console.log(t)}}},methods:i(i({},(0,o.mapMutations)(["saveLoginUserInfo"])),{},{changeColor:function(t){console.log(t),this.cornerBgColor=t.currentTarget.dataset.color,this.paint()},onKeyInput:function(t){this.wishText=t.target.value,this.paint()},paint:function(e,n){e||(e=this.avatarPath),n||(n=this.happinessPath),this.drawCansBgImg(e),this.drawCornerBg(),this.drawDefaultText(),t.vibrateShort({success:function(){console.log("vibrateShort")}})},drawCansBgImg:function(t){this.ctx.drawImage(t,0,0,this.cansWidth,this.cansHeight),this.ctx.draw(!1)},drawCornerBg:function(){this._drawCircleWithBoarder(this.cornerBgBoarderColor,this.cornerBgColor,this.cornerX,this.cornerY,this.r,this.boarderWidth)},drawHappiness:function(t){this.ctx.drawImage(t,this.cornerX+5,this.cornerY+7,.25*this.cansWidth,.25*this.cansHeight),this.ctx.draw(!0)},drawDefaultText:function(){var e={text:this.wishText,sLeft:.73,sTop:.93,fontSize:60,color:"white",bold:!0,lineHeight:12};this._drawText(e),t.vibrateShort({success:function(){console.log("vibrateShort")}})},_drawCircleWithBoarder:function(t,e,n,o,a,i){this.ctx.save();var s=n+a,c=o+a;this.ctx.arc(s,c,a,0,2*Math.PI),this.ctx.setLineWidth(i),this.ctx.setStrokeStyle(t),this.ctx.stroke(),this.ctx.setFillStyle(e),this.ctx.fill(),this.ctx.restore(),this.ctx.draw(!0)},_drawText:function(t){var e;if(e="center"==t.sLeft?.5*this.cansWidth-t.fontSize*t.text.length/2:t.sLeft*this.cansWidth,this.ctx.save(),t.bold&&(this.ctx.font="normal bold ".concat(t.fontSize,"px edu-lishu")),this.ctx.setFillStyle(t.color),this.ctx.setFontSize(t.fontSize),t.text instanceof Array){t.lineHeight||(t.lineHeight=t.fontSize+2),console.log("我是数组",t.text);for(var n=0;n<t.text.length;n++)this.ctx.fillText(t.text[n],e,t.sTop*this.cansHeight+t.lineHeight*n)}else console.log("绘制字符",t.text),this.ctx.fillText(t.text,e,t.sTop*this.cansHeight);this.ctx.draw(!0),this.ctx.restore()},downloadAvatarAndPaintAll:function(e){t.showLoading({title:"加载中..."});var n=this;t.downloadFile({url:e,success:function(e){t.hideLoading(),n.avatarPath=e.tempFilePath,getApp().globalData.userAvatarFilePath=e.tempFilePath,n.paint()},fail:function(o){console.log(o),t.hideLoading(),t.showModal({title:"图片加载超时",content:"检查网络，点击确定重新加载",success:function(t){t.confirm?n.downloadAvatarAndPaintAll(e):t.cancel&&console.log("用户点击取消")}})}})},getUserInfoCallBack:function(e){if(console.log("mpGetUserInfo",e),"getUserInfo:ok"===e.detail.errMsg){this.ownImageUsed=!0;var n=e.detail.userInfo;console.log(n),n.avatarUrl=n.avatarUrl.replace("132","0"),getApp().globalData.userAvatarUrl=n.avatarUrl,this.downloadAvatarAndPaintAll(n.avatarUrl),this.saveLoginUserInfo(n)}else t.showModal({title:"获取用户头像失败",content:"用户信息仅用于创建新的图片，请放心使用",showCancel:!1})},chooseImage:function(){var e=this;t.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){console.log(t);var n=t.tempFilePaths[0];e.imageCheck(n,e.loadRecImageOrStartToCrop)}})},loadRecImageOrStartToCrop:function(e){this.ownImageUsed=!0;var n=this;t.getImageInfo({src:e,success:function(o){var a=o.width,i=o.height,s=(a-i)/a.toFixed(3);if(console.log("delta",s),-.02<=s&&s<=0||0<s&&s<=.02){n.avatarPath=e,n.paint()}else t.navigateTo({url:"/pages/crop/crop?tempFilePath="+e})}})},checkAdBeforeSave:function(){h&&this.enableRewardedVideoAd&&this.rewardedVideoAdLoaded&&!this.rewardedVideoAdAlreadyShow&&this.savedCounts>=this.freeCount?t.showModal({title:"获取无限使用次数",content:"请完整观看趣味广告视频",success:function(t){if(t.confirm)console.log("用户点击确定"),h&&h.show().catch((function(){h.load().then((function(){h.show()})).catch((function(t){console.log(t),console.log("激励视频 广告显示失败")}))}));else if(t.cancel)return void console.log("用户点击取消")}}):this.saveCans()},saveCans:function(){console.log("保存...");var e=this;t.showLoading({title:"保存...",mask:!0}),t.canvasToTempFilePath({x:0,y:0,width:1.5*this.cansWidth,height:1.5*this.cansHeight,destWidth:3*this.cansWidth,destHeight:3*this.cansHeight,canvasId:"cans-id-happines",success:function(n){t.hideLoading(),t.saveImageToPhotosAlbum({filePath:n.tempFilePath,success:function(n){t.showToast({title:"请至相册查看"}),t.vibrateShort({success:function(){console.log("vibrateShort")}}),e.savedCounts++,d&&e.enableInterstitialAd&&!e.interstitialAdAlreadyShow&&!e.rewardedVideoAdAlreadyShow&&d.show().then((function(){e.interstitialAdAlreadyShow=!0})).catch((function(t){d.load().then((function(){d.show()})).catch((function(t){console.log(t),console.log("插屏广告显示失败")})),console.error(t)})),console.log("保存成功")},fail:function(e){console.log(e),e.errMsg.indexOf("fail")&&t.showModal({title:"您需要授权相册权限",success:function(e){e.confirm&&t.openSetting({success:function(t){console.log("相册授权成功")},fail:function(t){console.log(t)}})}})}})},fail:function(e){t.hideLoading()}},this)},imageCheck:function(e,n){if(getApp().globalData.enableSecurityCheck){t.compressImage({src:e,quality:1,success:function(o){var a=o.tempFilePath;wx.getFileSystemManager().readFile({filePath:a,success:function(o){console.log(o.data),t.showLoading({title:"加载中..."}),wx.cloud.callFunction({name:"contentCheck",data:{value:o.data},success:function(o){console.log("checkContent result",o),87014==o.result.errCode?(t.showModal({title:"请勿使用违法违规内容",content:"图片含有违法违规内容",showCancel:!1,confirmText:"知道了"}),console.log("bad")):(console.log("good"),n(e))},fail:function(e){console.log(e),t.showModal({title:"请重试",content:"对不起，服务器开了小差",showCancel:!1,confirmText:"好的"})},complete:function(){t.hideLoading()}})}})}})}else n(e)}})};e.default=u}).call(this,n("543d")["default"])},aaca:function(t,e,n){"use strict";var o;n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var a=function(){var t=this,e=t.$createElement;t._self._c},i=[]},c989:function(t,e,n){"use strict";var o=n("411b"),a=n.n(o);a.a},deaa:function(t,e,n){"use strict";(function(t){n("f47e");o(n("66fd"));var e=o(n("5740"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},e625:function(t,e,n){"use strict";n.r(e);var o=n("a287"),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=a.a}},[["deaa","common/runtime","common/vendor"]]]);